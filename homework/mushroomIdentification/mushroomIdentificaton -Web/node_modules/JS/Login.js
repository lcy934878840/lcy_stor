


//声明变量
//遮罩层移动变量
let register = true
let login = false
const loginText = '已经有帐号?'
const registerText = '还没有账号?'
//判断信息注册是否正确
let Check = false
//获取密码
let pwd = ''
//Dom节点
let mask = document.querySelector('.mask')
let form = document.querySelector('.form')
let RegisterButton = document.querySelector('.RegisterButton')
let LoginButton = document.querySelector('.LoginButton')
let P = document.querySelector('.content')
let a = document.querySelector('a')
let move = document.querySelector('.move')


P.innerHTML = loginText
//正则
const name_re=/^[\u4e00-\u9fa5a-zA-Z\d]+$/
const phone_re = /^1[3456789]\d{9}$/
const pwd_re = /^[a-zA-Z\d]{1,8}$/


//遮罩移动函数
function Move(){
    if (register){
        P.innerHTML = registerText
        document.querySelector('.move').innerHTML = '点击注册'
        mask.style.left='55%'
        login = true
        register = false
    }
    else if (login){
        P.innerHTML = loginText
        document.querySelector('.move').innerHTML = '点击登录'
        mask.style.left='5%'
        login = false
        register = true
    }

}
//判断信息是否正确
form.addEventListener('change',function (e){
    if(e.target.parentNode.className === 'pwd')  pwd=e.target.value //获取输入的密码
    Check=Judge(e.target.parentNode,e.target.parentNode.className,e.target.value)
})
function Judge(parentNode,classname,value){
    //获取当前i标签的class，并且转为数组
    let primaryClass = parentNode.children[1].className.split(' ')
    console.log(primaryClass)
    //判断用户名，电话，密码是否规范
    if ((classname === 'name' && name_re.test(value)) || (classname === 'phone' && phone_re.test(value)) ||
        (classname === 'pwd' && pwd_re.test(value)) ||(classname === 'confirmPwd' && value === pwd)){
        //移除原本i标签里的class
        for (let i = 0; i < primaryClass.length; i++) parentNode.children[1].classList.remove(primaryClass[i])
        //添加确认class
        parentNode.children[1].classList.add('fa','fa-check-circle')
        parentNode.children[1].style.color = 'chartreuse'
        Check = true
    }else {
        for (let i = 0; i < primaryClass.length; i++) parentNode.children[1].classList.remove(primaryClass[i])
        parentNode.children[1].classList.add('fa','fa-times-circle')
        parentNode.children[1].style.color = 'red'
        Check = false
    }

    return Check
}

/*定义注册事件*/
RegisterButton.addEventListener('click',function (e){
    const name = document.querySelector('.form .name input').value
    const phone = document.querySelector('.form .phone input').value
    const pwd = document.querySelector('.form .pwd input').value
    const checkCircleNum = document.querySelectorAll('.fa-check-circle').length
    /*信息正确，提交*/
    if (Check && checkCircleNum===4){
        $.ajax({
            url:"./register",
            type: "POST",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({"UserName":name,"UserPhone":phone,"UserPassword":pwd}),
            success:function(response){
                let reply=JSON.parse(response)['reply']
                alert(reply)
            },
        });
    }
    else alert('注册失败！信息存在错误！')
});
LoginButton.addEventListener('click',function (){
    const phone = document.getElementById('inputPhone').value
    const pwd = document.getElementById('inputPwd').value
    if (phone&&pwd){
        $.ajax({
            url:"./login",
            type: "POST",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({"inputPhone":phone,"inputPwd":pwd}),
            success:function(response){
                let reply=JSON.parse(response)['reply']
                if (reply)  window.open(encodeURI('./indexHome?'+'uname='+phone))
                else alert('登陆失败！请检查手机号或者密码是否正确')
                /*reply?location.href = './indexHome':alert('登陆失败！')*/
            },
        });
    }
    else alert('请输入手机号和密码再登录')

})